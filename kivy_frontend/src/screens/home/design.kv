#:import dp kivy.metrics.dp

<HomeScreen>:
    FloatLayout:
        MDBoxLayout:
            pos_hint: {"top": 1}
            size_hint_y: None
            height: dp(50)
            padding: dp(10)
            MDLabel:
                text: "MyStreet"
                bold: True
            
            MDIconButton:
                icon: "hamburger"
                on_release: app.root.ids.nav_drawer.set_state("toggle")

    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        MDBoxLayout:
            orientation: 'vertical'
            padding: ('5dp', '40dp', '5dp', '5dp')
            size_hint: None, None
            height: dp(700)
            width: dp(400)

            MDTextField:
                id: search_for_groups()
                size_hint_x: 1
                mode: "outlined"
                MDTextFieldHintText:
                    text: "Search for a group"
                MDTextFieldMaxLengthText:
                    max_text_length: 64
                    
            MDLabel:
                text: "MyStreet Groups"
                bold: True
                halign: "center"
                size_hint_y: None
                height: dp(50)
            RecycleView:
                id: groups_rv
                viewclass: "GroupItem"
                data: root.groups_data
                RecycleBoxLayout:
                    spacing: dp(5)
                    default_size: None, dp(170)
                    default_size_hint: 1, None
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height

        FloatLayout:
            MDButton:
                id: create_group_btn
                style: "elevated"
                pos_hint: {"right": 0.95, "y": 0.025}
                on_press:
                    app.root.ids.screen_manager.current = "create_group"
                    root.manager.transition.direction = "left"
                MDButtonIcon:
                    icon: "plus"
                MDButtonText:
                    text: "Create a Group"


<GroupItem@BoxLayout>:
    group_name: ""
    description: ""
    creator: ""
    group_id: ""
    allow_preview: True
    is_logged_in: None
    orientation: "horizontal"
    size_hint_y: None
    height: dp(80)
    padding: dp(8)
    spacing: dp(8)
    
    MDCard:
        padding: dp(10)
        radius: 5

        MDBoxLayout:
            orientation: 'vertical'
            MDBoxLayout:
                orientation: 'vertical'

                MDBoxLayout:
                    orientation: 'horizontal'
                    spacing: dp(10)
                    
                    MDIcon:
                        icon: "account-group"
                        size_hint: None, None
                        size: dp(24), dp(24)
                        theme_text_color: "Custom"
                        text_color: 1, 1, 1, 1

                    MDLabel:
                        text: root.group_name
                        theme_text_color: "Custom"
                        text_color: 1, 1, 1, 1
                        size_hint_y: None
                        height: dp(24)


                MDDivider:

                MDLabel:
                    text: root.description
                    size_hint_y: None
                    height: self.texture_size[1]
                    shorten: True
                    shorten_from: 'right'
                    max_lines: 2
                    theme_text_color: "Custom"

                MDLabel:
                    text: root.creator
                    markup: True

            MDBoxLayout:
                orientation: 'horizontal'
                
                Widget:
                
                MDButton:
                    on_press: app.root.ids.screen_manager.get_screen("home").handle_group_press(root.group_id, root.allow_preview) if root.is_logged_in or root.allow_preview else app.goto_screen("login")
                  
                    MDButtonIcon:
                        icon: "eye" if root.is_logged_in and root.allow_preview else "plus" if root.is_logged_in and not root.allow_preview else "eye-outline" if not root.is_logged_in and root.allow_preview else "login"
                    MDButtonText:
                        text: "View" if root.is_logged_in and root.allow_preview else "Request" if root.is_logged_in and not root.allow_preview else "Preview" if not root.is_logged_in and root.allow_preview else "Log in"
